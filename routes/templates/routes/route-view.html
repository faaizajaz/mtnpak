{% extends 'base.html' %}
{% load view_filters %}
{% load define %}
{% load static %}



{% block page_title %}
	{{ route.rname }}
{% endblock %}


<!--href="{% url 'rate-route' route_id=route.id %}"-->

{% block content %}


	<h1>This is the Routes View page</h1>

	{% if user.is_authenticated %}
		<a href="{% url 'logout' %}">Log out</a>
		<br>
		<a href="{% url 'profile' username=user.username %}">My Profile</a>
	{% else %}	
		<a href="{% url 'login' %}">Log in</a>
	{% endif %}


	<h1>{{ route.rname }}</h1>

	<p>{{ route.numpitch }} {{ route.rtype }}</p>

	<a class='rate-btn' data-href='{{ route.get_api_rate_url }}' href="{% url 'rate-route' route_id=route.id %}">Rate me!</a>
	<br><br>
	<p id="avg_score">{{route.avg_rating}}</p>











	<!--custom CSS for star ratings -->
	<link rel="stylesheet" type="text/css" href="{% static 'ratings/star_rating.css' %}" rel="stylesheet">


	


	<div data-api="{{ route.get_api_rate_url }}" class="rating" id="star-rating">
		Rate it yourself:

	    <input type="radio" id="star5" name="rating" value="5" data-api="{{ route.get_api_rate_url_5 }}"/><label class = "full" for="star5" title="5 stars"></label>

	    <input type="radio" id="star4" name="rating" value="4" data-api="{{ route.get_api_rate_url_4 }}"/><label class = "full" for="star4" title="4 stars"></label>

	    <input type="radio" id="star3" name="rating" value="3" data-api="{{ route.get_api_rate_url_3 }}"/><label class = "full" for="star3" title="3 stars"></label>

	    <input type="radio" id="star2" name="rating" value="2" data-api="{{ route.get_api_rate_url_2 }}"/><label class = "full" for="star2" title="2 stars"></label>
	
	    <input type="radio" id="star1" name="rating" value="1" data-api="{{ route.get_api_rate_url_1 }}"/><label class = "full" for="star1" title="1 star"></label>

	</div>

	<br><br>


	<!-- If the route only has one pitch, display the grade-->
	{% if route.numpitch == 'Singlepitch' %}
		
		<p>This single pitch is {{ route|measurement_display:request }}</p>
		{% for pitch in route.pitch_set.all %}
			<!--CHECK GRADE PREFERENCE AND DISPLAY GRADE ACCORDINGLY -->
			{{ pitch.pgrade|grade_display:request }}
			{{ pitch|measurement_display:request }}
			{{ pitch|measurement_unit_display:request }}

		{% endfor %}
	{% endif %}


	<!-- Otherwise, if the route has more than one pitch, list pitches-->	
	{% if route.numpitch == 'Multipitch' %}

		<p>This multipitch is {{ route|measurement_display:request }}</p>
		{% for pitch in route.pitch_set.all %}
			<p>
			{{ pitch.pgrade|grade_display:request }}
			{{ pitch|measurement_display:request }}
			{{ pitch|measurement_unit_display:request }}
			{{ pitch.pdescription }} 
			</p>
		{% endfor %}
	{% endif %}

	<!-- route description displayed here -->
	<p><b>Description:</b> {{ route.rdescription }}</p>
	
	<!-- display all ascents for the route -->
	{% for ascent in route.ascent_set.all %}
		<p>{{ ascent.date }}  <a href="{% url 'profile' username=ascent.climber.username %}">{{ ascent.climber.username }}</a></p>
	{% endfor %}
	
	<!-- add ascent button -->

	<br>
	<h3><a href="{% url 'add-ascent-to-route' route_id=route.id %}">ADD YOUR ASCENT</a></h3>


	<!--If route is multipitch, show add pitch button -->
	{% if route.numpitch == 'Multipitch' %}
		<h3><a href="{% url 'add-pitch-multi' route_id=route.id %}">Add a pitch</a></h3>
	{% endif %}

<script src="{% static 'ratings/rating_update.js' %}" type="text/javascript"></script>



{% endblock %}
